<!DOCTYPE html>
<html>
<head>
    <title>S620782-CustomPieChartFilterByDefectsAndTestSets</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",layout:"fit",filter:void 0,_includeProduction:!1,_includeAllDefects:!1,_includeTestSets:!1,_defects:!1,_testSets:!1,config:{defaultSettings:{types:"PortfolioItem/Feature",chartType:"piechart",aggregationField:"c_StrategyCategory",aggregationType:"prelimest",bucketBy:"",stackField:"",query:""}},launch:function(){var e=this.getContext().getProject().ObjectID;this._projectId=e,console.log("Project:",this._projectId),this.myMask=new Ext.LoadMask({msg:"Please wait...",target:this}),this._getFilterCombos(),this.getSetting("types")?Rally.data.wsapi.ModelFactory.getModels({types:this._getTypesSetting()}).then({success:this._onModelsLoaded,scope:this}):this.fireEvent("appsettingsneeded")},_getFilterCombos:function(){this.add([{xtype:"panel",id:"panelGraph",align:"stretch",bodyPadding:10,items:[{xtype:"fieldcontainer",defaultType:"checkboxfield",defaults:{flex:3},items:[{boxLabel:"Include Production Support",id:"includeP",name:"includeP",padding:"0 10 0 0",inputValue:"p",listeners:{change:function(e,t,i){this.myMask.show();var o=t;if(this._includeProduction=o,console.log("include production support:",o),o){Ext.getCmp("includeD").getValue()&&Ext.getCmp("includeD").setValue(!1);var s=this._loadDefects();Deft.Promise.all(s).then({success:function(e){console.log("defects loaded:",e),this._defects=e,this.onTimeboxScopeChange()},failure:function(e){console.log("error:",e)},scope:this})}else Ext.getCmp("includeD").getValue()||this.onTimeboxScopeChange()},scope:this}},{boxLabel:"Include All Defects",id:"includeD",name:"includeD",padding:"0 10 0 0",inputValue:"d",listeners:{change:function(e,t,i){this.myMask.show();var o=t;if(this._includeAllDefects=o,console.log("include all defects:",o),o){Ext.getCmp("includeP").getValue()&&Ext.getCmp("includeP").setValue(!1);var s=this._loadDefects();Deft.Promise.all(s).then({success:function(e){console.log("all defects loaded:",e),this._defects=e,this.onTimeboxScopeChange()},failure:function(e){console.log("error:",e)},scope:this})}else Ext.getCmp("includeP").getValue()||this.onTimeboxScopeChange()},scope:this}},{boxLabel:"Include TestSets",id:"includeT",name:"includeT",padding:"0 10 0 0",inputValue:"t",listeners:{change:function(e,t,i){this.myMask.show();var o=t;this._includeTestSets=o,console.log("include testSets:",o);var s=this._loadTestSets();Deft.Promise.all(s).then({success:function(e){console.log("all `testSets loaded:",e),this._testSets=e,this.onTimeboxScopeChange()},failure:function(e){console.log("error:",e)},scope:this})},scope:this}}]}]}])},_loadDefects:function(){var e=this._projectId;console.log("project:",e);var t=Ext.create("Deft.Deferred"),i=this._getFilter();return Ext.create("Rally.data.wsapi.Store",{model:"Defect",autoLoad:!0,fetch:["Name","ObjectID","FormattedID","PlanEstimate","Environment","Release"],context:{projectScopeUp:!1,projectScopeDown:!0,project:/project/+e},filters:i,limit:1/0,listeners:{load:function(e,i,o){console.log("defects store",e,i),t.resolve(i)}},scope:this}),t.promise},_loadTestSets:function(){var e=this._projectId;console.log("project:",e);var t=Ext.create("Deft.Deferred"),i=this._getCustomFilters();return Ext.create("Rally.data.wsapi.Store",{model:"TestSet",autoLoad:!0,fetch:["Name","ObjectID","FormattedID","PlanEstimate","Release"],context:{projectScopeUp:!1,projectScopeDown:!0,project:/project/+e},filters:i,limit:1/0,listeners:{load:function(e,i,o){console.log("testSet store",e,i),t.resolve(i)}},scope:this}),t.promise},_getFilter:function(){var e,t=this._getCustomFilters();return this._includeProduction?e=Rally.data.QueryFilter.or([{property:"Environment",operator:"=",value:"Production"},{property:"Environment",operator:"=",value:""}]):this._includeAllDefects&&(e=[]),e&&0!==e.length?(e=t.and(e),console.log("final filter",e),console.log("final filter string",e.toString()),e):t},_getCustomFilters:function(){return console.log("filters: currentCustom:",Ext.getCmp("panelGraph").items.get(1).currentCustomFilter.filters),Ext.getCmp("panelGraph").items.get(1).currentCustomFilter.filters[0]},getSettingsFields:function(){return Settings.getSettingsFields(this.getContext())},_shouldLoadAllowedStackValues:function(e){return e&&e.hasAllowedValues()&&(_.contains(["state","rating","string"],e.getType())||"state"===e.getAllowedValueType()||"flowstate"===e.getAllowedValueType())},_onModelsLoaded:function(e){this.models=_.values(e);var t=this.models[0],i=this._getStackingSetting(),o=i&&t.getField(i);this._shouldLoadAllowedStackValues(o)?o.getAllowedValueStore().load().then({success:function(e){this.stackValues=_.invoke(e,"get","StringValue"),this._addChart()},scope:this}):this._addChart()},_addChart:function(){var e=this.getContext(),t=["Milestones","Tags"],i=_.pluck(this.models,"typePath"),o={xtype:"rallygridboard",toggleState:"chart",chartConfig:this._getChartConfig(),plugins:[{ptype:"rallygridboardinlinefiltercontrol",showInChartMode:!0,inlineFilterButtonConfig:{stateful:!0,stateId:e.getScopedStateId("filters"),filterChildren:!0,modelNames:i,inlineFilterPanelConfig:{quickFilterPanelConfig:{defaultFields:this._getQuickFilters(),addQuickFilterConfig:{whiteListFields:t}},advancedFilterPanelConfig:{advancedFilterRowsConfig:{propertyFieldConfig:{whiteListFields:t}}}}}},{ptype:"rallygridboardactionsmenu",menuItems:[{text:"Export to CSV...",handler:function(){window.location=Rally.ui.gridboard.Export.buildCsvExportUrl(this.down("rallygridboard").getGridOrBoard())},scope:this}],buttonConfig:{iconCls:"icon-export",toolTipConfig:{html:"Export",anchor:"top",hideDelay:0}}}],context:e,modelNames:i,storeConfig:{filters:this._getFilters()}};this.down("#panelGraph").add(o),console.log("comp",Ext.getCmp("panelGraph"))},_getQuickFilters:function(){var e=["Owner","State","ScheduleState"],t=this.models[0];return this.models.length>1&&e.push("ModelType"),_.filter(e,function(e){return t.hasField(e)})},_getTypesSetting:function(){return this.getSetting("types").split(",")},_getStackingSetting:function(){return"piechart"!==this.getSetting("chartType")?this.getSetting("stackField"):null},_getChartConfig:function(){var e=this.getSetting("chartType"),t=this._getStackingSetting(),i=this.stackValues,o=this.models[0],s={xtype:e,enableStacking:!!t,chartColors:["#FF8200","#F6A900","#FAD200","#8DC63F","#1E7C00","#337EC6","#005EB8","#7832A5","#DA1884","#C0C0C0"],storeConfig:{context:this.getContext().getDataContext(),limit:1/0,fetch:this._getChartFetch(),sorters:this._getChartSort(),pageSize:2e3},calculatorConfig:{calculationType:this.getSetting("aggregationType"),field:this.getSetting("aggregationField"),stackField:t,stackValues:i,bucketBy:"piechart"===e?null:this.getSetting("bucketBy"),includeProduction:this._includeProduction,includeAllDefects:this._includeAllDefects,includeTestSets:this._includeTestSets,projectId:this._projectId,defects:this._defects,testSets:this._testSets}};return o.isArtifact()?(s.storeConfig.models=this._getTypesSetting(),s.storeType="Rally.data.wsapi.artifact.Store"):(s.storeConfig.model=o,s.storeType="Rally.data.wsapi.Store"),s},onTimeboxScopeChange:function(){this.callParent(arguments);var e=this.down("rallygridboard");e&&e.destroy(),this._addChart(),this.myMask.hide()},_getChartFetch:function(){var e=this.getSetting("aggregationField"),t=this.getSetting("aggregationType"),i=this._getStackingSetting(),o=["FormattedID","Name",e];return"count"!==t&&o.push(Utils.getFieldForAggregationType(t)),i&&o.push(i),_.contains(o,"Iteration")&&o.push("StartDate"),_.contains(o,"Release")&&o.push("ReleaseStartDate"),o},_getChartSort:function(){var e=this.models[0].getField(this.getSetting("aggregationField")),t=[];return e&&"collection"!==e.getType()&&e.sortable&&t.push({property:this.getSetting("aggregationField"),direction:"ASC"}),t},_getFilters:function(){console.log("get filtes",this.getContext(),this.getContext().getTimeboxScope());var e=[],t=this.getContext().getTimeboxScope();if(this.getSetting("query")){var i=this.getSetting("query").replace(/\{user\}/g,this.getContext().getUser()._ref);e.push(Rally.data.QueryFilter.fromQueryString(i))}return t&&_.any(this.models,t.isApplicable,t)&&e.push(t.getQueryFilter()),console.log("query",e),e}});
                Ext.define("Utils",{singleton:!0,getFieldForAggregationType:function(e){switch(e){case"acceptedleafcount":return"AcceptedLeafStoryCount";case"acceptedleafplanest":return"AcceptedLeafStoryPlanEstimateTotal";case"leafcount":return"LeafStoryCount";case"leafplanest":return"LeafStoryPlanEstimateTotal";case"prelimest":return"PreliminaryEstimateValue";case"refinedest":return"RefinedEstimate";case"taskest":return"Estimate";case"taskactuals":return"Actuals";default:return"PlanEstimate"}}});
                Ext.define("Calculator",{config:{calculationType:void 0,field:void 0,stackField:void 0,stackValues:void 0,bucketBy:void 0,includeProduction:void 0,includeAllDefects:void 0,includeTestSets:void 0,projectId:void 0,defects:void 0,testSets:void 0},constructor:function(t){this.initConfig(t)},prepareChartData:function(t){var e=this._prepareChartData(t);return _.contains([this.field,this.stackField],"DisplayColor")&&this._makeColorsSane(e),e},_hexToColor:_.memoize(function(t){return _.find(Rally.util.Colors.DISPLAY_COLOR_PALETTE,function(e){return e.value.toLowerCase()===t.toLowerCase()})}),_makeColorsSane:function(t){return"DisplayColor"===this.field?(this.stackField||(t.series[0].data=_.map(t.series[0].data,function(t){var e=_.find(Rally.util.Colors.DISPLAY_COLOR_PALETTE,function(e){return e.value.toLowerCase()===t[0].toLowerCase()}),i={name:e&&e.name||t[0],y:t[1]};return e&&e.value&&(i.color=e.value),i})),t.categories=_.map(t.categories,function(t){var e=this._hexToColor(t);return e&&e.name||t},this)):"DisplayColor"===this.stackField&&_.each(t.series,function(t){var e=t.name,i=this._hexToColor(e);i&&(t.name=i&&i.name||e,t.color=e)},this),t},_prepareChartData:function(t){console.log("store",t);var e,i=this._groupData(t),o=_.keys(i);if(console.log("data",i),console.log("stack",this.stackField),console.log("calc type",this.calculationType),this.stackField){var a,n=t.model.getField(this.stackField);if(this.stackValues)a=_.map(this.stackValues,function(t){return this._getDisplayValue(n,t)},this);else{var s=_.invoke(t.getRange(),"get",this.stackField);"Iteration"!==this.stackField&&"Release"!==this.stackField||(s=_.sortBy(s,function(t){var e=t&&(t.StartDate||t.ReleaseStartDate||null);return new Date(e)})),a=_.unique(_.map(s,function(t){return this._getDisplayValue(n,t)},this))}var r={};return _.each(o,function(t){var e=i[t],o=_.groupBy(e,function(t){return this._getDisplayValueForField(t,this.stackField)},this);_.each(a,function(t){r[t]=r[t]||[];var e=o[t];if("count"===this.calculationType)r[t].push(e&&e.length||0);else{var i=_.reduce(e,function(t,e){var i=this._getValueFieldForCalculationType();return t+e.get(i)},0,this);r[t].push(i)}},this)},this),{categories:o,series:_.map(a,function(t){return{name:t,type:this.seriesType,data:r[t]}},this)}}return e="count"===this.calculationType?_.map(i,function(t,e){return[e,t.length]}):_.map(i,function(t,e){return[e,_.reduce(t,function(t,e){var i=this._getValueFieldForCalculationType();return t+e.get(i)},0,this)]},this),console.log("series",e),console.log("include production",this.includeProduction),(this.includeProduction||this.includeAllDefects)&&this._includeDefectsInCalculation(e),this.includeTestSets&&this._includeTestSetCalculation(e),{categories:o,series:[{name:this.field,type:this.seriesType,data:e}]}},_includeDefectsInCalculation:function(t){console.log("including defects:",this.defects);var e=this._getAllDefectPoints();this._updateSeriesData(t,e)},_includeTestSetCalculation:function(t){console.log("including testSet:",this.testSets);var e=this._getAllTestSetPoints();this._updateSeriesData(t,e)},_getAllDefectPoints:function(){var t=0;return _.each(this.defects,function(e){t+=e.get("PlanEstimate")},this),console.log("total defects:",t),t},_getAllTestSetPoints:function(){var t=0;return _.each(this.testSets,function(e){t+=e.get("PlanEstimate")},this),console.log("total testSets:",t),t},_updateSeriesData:function(t,e){_.each(t,function(t){console.log("looking for production efftorts"),console.log(t),"Production Efforts"===t[0]&&(t[1]+=e)},this)},_groupData:function(t){console.log("looking for field",this.field);var e=t.model.getField(this.field),i=e.getType(),o={};if(console.log("field",e),console.log("field type",i),"collection"===i)return _.each(t.getRange(),function(t){var e=t.get(this.field)._tagsNameArray;_.isEmpty(e)?(o.None=o.None||[],o.None.push(t)):_.each(e,function(e){o[e.Name]=o[e.Name]||[],o[e.Name].push(t)})},this),o;if(o=_.groupBy(t.getRange(),function(t){return this._getDisplayValueForField(t,this.field)},this),console.log("groups",o),"date"===i){var a=_.sortBy(_.compact(_.map(t.getRange(),function(t){return t.get(this.field)},this))),n=this._getDateRange(a[0],a[a.length-1]),s={};o["-- No Entry --"]&&(s["-- No Entry --"]=o["-- No Entry --"]),o=_.reduce(n,function(t,i){var a=this._getDisplayValue(e,moment(i).toDate());return t[a]=o[a]||[],t},s,this)}return o},_getDateRange:function(t,e){var i=t,o=[],a="d";for("week"===this.bucketBy?a="w":"month"===this.bucketBy?a="M":"quarter"===this.bucketBy?a="Q":"year"===this.bucketBy&&(a="y");i<=e;)o.push(i),i=moment(i).add(1,a).toDate();return o.push(e),o},_getDisplayValueForField:function(t,e){var i=t.getField(e),o=t.get(e);return this._getDisplayValue(i,o)},_getDisplayValue:function(t,e){if(!_.isDate(e)){if(_.isObject(e))return e._refObjectName;if(Ext.isEmpty(e)){var i=t.getType();return"User"===t.attributeDefinition.SchemaType?"-- No Owner --":"rating"===i||"object"===i?"None":"-- No Entry --"}return e}return this.bucketBy&&"day"!==this.bucketBy?"week"===this.bucketBy?Rally.util.DateTime.formatWithDefault(moment(e).startOf("week").toDate()):"month"===this.bucketBy?moment(e).startOf("month").format("MMM 'YY"):"quarter"===this.bucketBy?moment(e).startOf("quarter").format("YYYY [Q]Q"):"year"===this.bucketBy?moment(e).startOf("year").format("YYYY"):void 0:Rally.util.DateTime.formatWithDefault(e)},_getValueFieldForCalculationType:function(){return Utils.getFieldForAggregationType(this.calculationType)}});
                Ext.define("BarCalculator",{extend:"Calculator",seriesType:"bar"});
                Ext.define("BarChart",{xtype:"barchart",extend:"Rally.ui.chart.Chart",requires:["BarCalculator"],config:{chartConfig:{chart:{type:"bar"},title:{text:""},yAxis:{min:0,title:{text:""},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:"gray"}},reversedStacks:!1},plotOptions:{bar:{stacking:"normal",dataLabels:{enabled:!1},showInLegend:!0,colorByPoint:!1}}},calculatorType:"BarCalculator"},constructor:function(t){t=t||{},this.mergeConfig(t),this.chartConfig.plotOptions.bar.showInLegend=this.enableStacking,this.chartConfig.plotOptions.bar.colorByPoint=!this.enableStacking,this.enableStacking||(this.chartConfig.tooltip={headerFormat:"",pointFormat:"{point.name}: <b>{point.y}</b>"}),this.callParent([this.config])},_isData:function(t){return t>0||!(!t||!t.y)}});
                Ext.define("ColumnCalculator",{extend:"Calculator",seriesType:"column"});
                Ext.define("ColumnChart",{xtype:"columnchart",extend:"Rally.ui.chart.Chart",requires:["ColumnCalculator"],config:{chartConfig:{chart:{type:"column"},title:{text:""},yAxis:{min:0,title:{text:""},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:"gray"}},reversedStacks:!1},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1},showInLegend:!1,colorByPoint:!0}}},calculatorType:"ColumnCalculator"},constructor:function(t){t=t||{},this.mergeConfig(t),this.chartConfig.plotOptions.column.showInLegend=this.enableStacking,this.chartConfig.plotOptions.column.colorByPoint=!this.enableStacking,this.enableStacking||(this.chartConfig.tooltip={headerFormat:"",pointFormat:"{point.name}: <b>{point.y}</b>"}),this.callParent([this.config])},_isData:function(t){return t>0||!(!t||!t.y)}});
                Ext.define("PieCalculator",{extend:"Calculator",seriesType:"pie"});
                Ext.define("PieChart",{xtype:"piechart",extend:"Rally.ui.chart.Chart",requires:["PieCalculator"],config:{chartConfig:{chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:""},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}:</b> {point.percentage:.1f}% ({point.y}/{point.total})"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}:</b> {point.percentage:.1f}% ({point.y}/{point.total})",style:{color:"black"}}}}},calculatorType:"PieCalculator"},constructor:function(t){t=t||{},this.mergeConfig(t),this.callParent([this.config])},_isData:function(t){return t>0||!(!t||!t.y)}});
                Ext.define("Settings",{singleton:!0,getSettingsFields:function(e){return[{name:"chartType",xtype:"rallycombobox",plugins:["rallyfieldvalidationui"],fieldLabel:"Chart Type",displayField:"name",valueField:"value",editable:!1,allowBlank:!1,store:Ext.create("Ext.data.Store",{fields:["name","value"],data:[{name:"Bar",value:"barchart"},{name:"Column",value:"columnchart"},{name:"Pie",value:"piechart"}]}),listeners:{change:function(e){e.fireEvent("chartselected",e.getValue(),e.context)}},bubbleEvents:["chartselected"],handlesEvents:{typeselected:function(){this.fireEvent("chartselected",this.getValue())}}},{name:"types",xtype:"rallycombobox",plugins:["rallyfieldvalidationui"],allowBlank:!1,editable:!1,autoSelect:!1,validateOnChange:!1,validateOnBlur:!1,fieldLabel:"Type",shouldRespondToScopeChange:!0,context:e,storeConfig:{model:"TypeDefinition",sorters:[{property:"DisplayName"}],fetch:["DisplayName","TypePath"],filters:[{property:"UserListable",value:!0}],autoLoad:!1,remoteSort:!1,sortOnLoad:!0,remoteFilter:!0},displayField:"DisplayName",valueField:"TypePath",listeners:{change:function(e){e.fireEvent("typeselected",e.getValue(),e.context)},ready:function(e){e.fireEvent("typeselected",e.getValue(),e.context)}},bubbleEvents:["typeselected"],readyEvent:"ready",handlesEvents:{projectscopechanged:function(e){this.refreshWithNewContext(e)}}},{name:"aggregationField",xtype:"rallyfieldcombobox",plugins:["rallyfieldvalidationui"],fieldLabel:"Aggregate By",readyEvent:"ready",allowBlank:!1,validateOnChange:!1,validateOnBlur:!1,width:300,handlesEvents:{typeselected:function(e,t){var a=Ext.Array.from(e)[0];a?this.refreshWithNewModelType(a,t):(this.store.removeAll(),this.reset())}},bubbleEvents:["fieldselected"],listeners:{change:function(e){e.getRecord()&&e.fireEvent("fieldselected",e.getRecord().get("fieldDefinition"))},ready:function(e){e.store.filterBy(function(e){var t=e.get("fieldDefinition"),a=t.attributeDefinition;return a&&!a.Hidden&&(("COLLECTION"!==a.AttributeType||t.isMultiValueCustom())&&!t.isMappedFromArtifact||_.contains(["Tags","Milestones"],t.name))});var t=Ext.Array.map(e.store.getRange(),function(t){return t.get(e.getValueField())});Ext.Array.contains(t,e.getValue())||e.setValue(t[0]),e.getRecord()&&e.fireEvent("fieldselected",e.getRecord().get("fieldDefinition"))}}},{name:"bucketBy",xtype:"rallycombobox",plugins:["rallyfieldvalidationui"],fieldLabel:"Bucket By",displayField:"name",valueField:"value",editable:!1,allowBlank:!1,store:{fields:["name","value"],data:[{name:"Day",value:"day"},{name:"Week",value:"week"},{name:"Month",value:"month"},{name:"Quarter",value:"quarter"},{name:"Year",value:"year"}]},lastQuery:"",hidden:!0,toggleVisibility:function(){"date"===this.selectedFieldType&&"piechart"!==this.selectedChartType?this.show():this.hide()},handlesEvents:{fieldselected:function(e){this.selectedFieldType=e.getType(),this.toggleVisibility()},chartselected:function(e){this.selectedChartType=e,this.toggleVisibility()}}},{name:"aggregationType",xtype:"rallycombobox",plugins:["rallyfieldvalidationui"],fieldLabel:"Aggregation Type",displayField:"name",valueField:"value",editable:!1,allowBlank:!1,width:300,store:{fields:["name","value"],data:[{name:"Accepted Leaf Story Count",value:"acceptedleafcount"},{name:"Accepted Leaf Story Plan Estimate Total",value:"acceptedleafplanest"},{name:"Count",value:"count"},{name:"Plan Estimate Total",value:"estimate"},{name:"Leaf Story Count",value:"leafcount"},{name:"Leaf Story Plan Estimate Total",value:"leafplanest"},{name:"Preliminary Estimate Total",value:"prelimest"},{name:"Refined Estimate Total",value:"refinedest"},{name:"Actuals Total",value:"taskactuals"},{name:"Estimate Total",value:"taskest"}]},lastQuery:"",handlesEvents:{typeselected:function(e){var t=Ext.Array.from(e)[0];Rally.data.ModelFactory.getModel({type:t,success:function(e){this.store.filterBy(function(t){return"count"===t.get("value")||e.hasField(Utils.getFieldForAggregationType(t.get("value")))}),this.store.findRecord("value",this.getValue())||this.setValue("count")},scope:this})}}},{name:"stackField",xtype:"rallyfieldcombobox",plugins:["rallyfieldvalidationui"],fieldLabel:"Stack By",readyEvent:"ready",allowBlank:!1,allowNoEntry:!0,noEntryText:"-- No Stacking --",validateOnChange:!1,validateOnBlur:!1,width:300,hidden:!0,toggleVisibility:function(e){"piechart"===e?(this.hide(),this.select(this.store.getRange()[0])):this.show()},handlesEvents:{chartselected:function(e){this.toggleVisibility(e)},typeselected:function(e,t){var a=Ext.Array.from(e)[0];a&&this.refreshWithNewModelType(a,t)}},listeners:{ready:function(e){e.store.filterBy(function(t){var a=t.get("fieldDefinition"),l=a.attributeDefinition;return t.get(e.getValueField())===e.noEntryValue||l&&!l.Hidden&&a.hasAllowedValues()&&!_.contains(["collection"],a.getType())});var t=Ext.Array.map(e.store.getRange(),function(t){return t.get(e.getValueField())});Ext.Array.contains(t,e.getValue())||e.setValue(t[0])}}},{type:"query"}]}});

            Rally.launchApp('CustomApp', {
                name:"S620782-CustomPieChartFilterByDefectsAndTestSets",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
